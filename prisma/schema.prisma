generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  SUPER_ADMIN
  ADMIN
  KEUANGAN
  RESEPSIONIS
}

enum BookingSource {
  ONLINE
  RESEPSIONIS
}

enum BookingStatus {
  PENDING
  TERKONFIRMASI
  CHECK_IN
  CHECK_OUT
  BATAL
}

enum PaymentMethod {
  ONLINE
  CASH
}

enum PaymentStatus {
  UNPAID
  PAID
  EXPIRED
}

model User {
  id       String @id @default(uuid())
  name     String
  email    String @unique
  password String
  role     Role

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  payments  Payment[]
}

model Customer {
  id    String @id @default(uuid())
  name  String
  email String
  phone String

  bookings Booking[]

  createdAt DateTime @default(now())
}

model RoomType {
  id          String  @id @default(uuid())
  name        String
  description String?
  price       Int
  capacity    Int

  rooms Room[]

  createdAt DateTime @default(now())
}

model Room {
  id         String  @id @default(uuid())
  roomNumber String  @unique
  roomTypeId String
  isActive   Boolean @default(true)

  roomType RoomType  @relation(fields: [roomTypeId], references: [id])
  bookings Booking[]
}

model Booking {
  id          String @id @default(uuid())
  bookingCode String @unique

  source BookingSource

  customerId String
  roomId     String

  checkInDate  DateTime
  checkOutDate DateTime

  bookingStatus BookingStatus
  paymentMethod PaymentMethod

  customer Customer @relation(fields: [customerId], references: [id])
  room     Room     @relation(fields: [roomId], references: [id])
  payment  Payment?

  createdAt     DateTime       @default(now())
  guestIdentity GuestIdentity?
}

model Payment {
  id        String @id @default(uuid())
  bookingId String @unique

  method PaymentMethod
  status PaymentStatus
  amount Int

  // ONLINE (DOKU)
  gateway       String?
  transactionId String?
  rawCallback   Json?

  // CASH
  receivedById String?

  booking    Booking @relation(fields: [bookingId], references: [id])
  receivedBy User?   @relation(fields: [receivedById], references: [id])

  paidAt    DateTime?
  createdAt DateTime  @default(now())
}

model GuestIdentity {
  id        String @id @default(uuid())
  bookingId String @unique

  idType   String
  idNumber String

  verifiedBy String

  booking Booking @relation(fields: [bookingId], references: [id])

  createdAt DateTime @default(now())
}
